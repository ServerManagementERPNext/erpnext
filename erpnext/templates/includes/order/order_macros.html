{% from "erpnext/templates/includes/macros.html" import product_image %}

{% macro item_name_and_description(d, doc=None) %}
	<div class="row item_name_and_description">
		<div class="col-xs-4 col-sm-2 order-image-col">
			<div class="order-image">
				{% if d.thumbnail or d.image %}
					{{ product_image(d.thumbnail or d.image, no_border=True) }}
				{% else %}
					<div class="no-image-cart-item" style="min-height: 100px;">
						{{ frappe.utils.get_abbr(d.item_name) or "NA" }}
					</div>
				{% endif %}
			</div>
		</div>
		<div class="col-xs-8 col-sm-10">
			<strong>{{ d.item_code }}</strong>
			<div class="small item-description">
				{{ html2text(d.description) | truncate(140) }}

				{% if d.deployment_name %}
				<div class="mt-2">
					{% if doc %}
					{% set sales_order = doc.name if doc.doctype == "Sales Order" else d.sales_order %}
					{% set sales_order_item = d.name if doc.doctype == "Sales Order" else d.so_detail %}
					{% endif %}
					{% if sales_order and sales_order_item %}
						{% set deployment = frappe.db.get_value("Deployment", {
							"sales_order": sales_order, "sales_order_item": sales_order_item
						}) %}
						{% if deployment %}
						<a href="/deployments/{{ deployment }}" target="_blank">Deployment: {{ d.deployment_name }}</a>
						{% else %}
						Deployment: {{ d.deployment_name }}
						{% endif %}
					{% endif %}
				</div>
				{% endif %}
			</div>
		</div>
	</div>
{% endmacro %}

{% macro item_name_and_description_cart(d) %}
	<div class="row item_name_dropdown">
		<div class="col-xs-4 col-sm-4 order-image-col">
			<div class="order-image">
			 {{ product_image_square(d.thumbnail or d.image) }}
			</div>
		</div>
		<div class="col-xs-8 col-sm-8">
		   {{ d.item_name|truncate(25) }}
			<div class="input-group number-spinner">
				<span class="input-group-btn">
					<button class="btn btn-light cart-btn" data-dir="dwn">
						â€“</button>
				</span>
				<input class="form-control text-right cart-qty"
					value = "{{ d.get_formatted('qty') }}"
					data-item-code="{{ d.item_code }}">
				<span class="input-group-btn">
					<button class="btn btn-light cart-btn" data-dir="up">
						+</button>
				</span>
			</div>
		</div>
	</div>
{% endmacro %}
